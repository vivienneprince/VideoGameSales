---
title: "VideoGameSales"
author: "amanda, ben, and viv"
output: 
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '3'
    toc_float: yes
---

```{r, eval=TRUE, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(ggplot2)
library(plotly)


project.dir <- getwd()
dataset.dir <- "data"
outputs.dir <- "output"
```

# 0. Data Import and Cleaning {.tabset}

## Data Import
```{r}
videogames.df <- read.csv(file.path(project.dir, dataset.dir, 'vgsales-12-4-2019.csv'))
colnames(videogames.df)
```

## Data cleaning
Since the data was collected in April of 2019, we are excluding games with year = 2019 since it does not give a comprehensive picture of all the sales during 2019. 
```{r}
videogames.clean <- videogames.df %>% filter(Year < 2019)
```

## Data reshaping
We want to compare sales across different regions, so it would be convenient to have one column "region" and then a corresponding column for sales in USD (millions).
```{r}
vs_byregion <- videogames.clean %>% gather(Region, Sales, Global_Sales:Other_Sales, na.rm = T)
```




# 1. Descriptive analysis {.tabset}

Conduct some descriptive analysis on the data, figuring out:
* distributions of variables,
* variables that appear to be strongly related with each other (using appropriate methods to quantify the relationships based on whether variables are numerical or categorical).

```{r}
for (var in videogames.clean){
  hist(var)
  print(var)
}
```


## All Sales
From the boxplot we can see that we have 2 extreme outliers. After investigating, it looks like two outliers are GTA V (ps3 and ps4)
```{r}
hist(videogames.clean$Global_Sales, xlab = 'Global Sales (millions of USD)')

hist(videogames.clean$Global_Sales,
     xlab = 'Global Sales (millions of USD)',
     xlim = c(0, .5),
     breaks = 10000)

boxplot(videogames.clean$Global_Sales, xlab = 'Global Sales (millions of USD)')
videogames.clean[which(videogames.clean$Global_Sales > 17), ]


```

## Sales by year 
```{r}
vs_sales.byregion.byyear <- vs_byregion %>% group_by(Year, Region)  %>% summarize(Sales = sum(Sales))
vs_sales.byregion.byyear %>% ggplot(aes(x=Year, y= Sales))+
  geom_line(aes(color = Region))
```

## Scoring
Here we looked at distribution of User Scores and Critic Scores as well as the average Critic and User Score over time.
```{r}
fig <- plot_ly(x = videogames.clean$Critic_Score[which(!is.na(videogames.clean$Critic_Score))],
             type = "histogram")

fig

ggplotly(
  videogames.clean %>% ggplot() +
    geom_histogram(binwidth = 0.5,aes(x = Critic_Score) ) +
    geom_histogram(binwidth = 0.5,aes(x = User_Score, fill = "pink") ) 
    
)

ggplotly(
  videogames.clean %>% group_by(Year) %>% summarise(
    User_Score = mean(User_Score, na.rm = T),
    Critic_Score = mean(Critic_Score, na.rm = T), 
    Vgchartzscore = mean(Vgchartzscore, na.rm = T)) %>% 
    filter(Year >= 1989) %>%
    mutate(User_Score2 = case_when(Year >= 1996 ~ User_Score,
                             TRUE ~ NaN)) %>%
    gather(ScoreType, Score, c(User_Score,Critic_Score,Vgchartzscore), na.rm = T)
 %>%
    
    ggplot(aes(x = Year)) + # TODO : Make look better
    geom_line(aes(y = Score, color = ScoreType)) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
    scale_x_continuous("ID", labels = 1980:2018, breaks = 1980:2018) +
    xlab("ID") +
    xlim(1989, 2018
    )
)

```


## Sales per puplisher
## Sales per rating
## Sales per genre 

## genre distribution



# 2. One sample stats inference for response variable of interest (sales) bib
	⁃	construct CI for population mean value for sales
	⁃
	⁃	assumptions:
	⁃	sample is randomized: we will pick a random sample from our data
	⁃	population distribution is approximately normal: 
	⁃	NO, very left skewed, but we will use large sample sizes so that will not be too much of a problem
	⁃	Extreme outliers: 
	⁃	we will remove extreme outliers (GTA V)



# 3. Construct confidence interval for proportion of video games in a certain genre (Action) (conduct hypothesis test against pre-specified constant)
Here we conducted a t test with 95% confidence intervals looking at sales for the Action Genre. We ignored any NA values. We can see that the mean video game sales does not fall into our 95% confidence intervals for Action game sales. Thus, we reject the null hypothesis.
```{r}

#Ignored all NA values

actions <- videogames.clean %>% filter(Genre == 'Action')

t.test(actions$Global_Sales, conf.level = 0.95)

actionconf <- t.test(actions$Global_Sales, conf.level = 0.95)$conf.int

actionconf

# 0.3780538 0.4555330

#Null Hypothesis would be that mean video game sales falls between .378 and .456

avgsales<-mean(videogames.clean$Global_Sales,na.rm=T)
avgsales

#0.3670216

#Mean does not fall into 95% confidence interval so we reject Null Hypothesis

```


# 4. Our two-sample test variables will be looking at the differences in sales between two genre types: sports and shooters. We choose these genres as they are most frequent and are very popular with similar gaming crowds ie. FIFA vs. COD essentially.
SALES in SPORTS VS SHOOterS
H_0: mean sales sports - mean sales shooter = 0
H_a: not equal 0

# 5. We will (c) construct a confidence interval for population correlation between critic score and sales using bootstrap.





